# å®ç°è®¡åˆ’æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0
> æ—¥æœŸï¼š2025-01-31

## ğŸ“‹ é¡¹ç›®æ€»è§ˆ

**é¡¹ç›®ç›®æ ‡ï¼š** åˆ›å»ºä¸€ä¸ªè½»é‡çº§ã€é«˜å¯ç”¨çš„ Gemini Business API è½¬æ¢æœåŠ¡ï¼Œæ”¯æŒ OpenAI/Gemini/Claude ä¸‰ç§ API æ ¼å¼ã€‚

**éƒ¨ç½²ç¯å¢ƒï¼š** æ ‘è“æ´¾5 + Docker

**å¼€å‘ç­–ç•¥ï¼š** åˆ†é˜¶æ®µå®ç°ï¼Œå…ˆæ ¸å¿ƒåå®Œå–„

---

## ğŸ¯ å¼€å‘é‡Œç¨‹ç¢‘

### Phase 1ï¼šæ ¸å¿ƒ API åŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰
**ç›®æ ‡ï¼š** å®ç°åŸºç¡€çš„ API è½¬æ¢å’Œè´¦å·ç®¡ç†ï¼Œä½¿ç”¨ JSON é…ç½®

**äº¤ä»˜ç‰©ï¼š**
- âœ… Token è‡ªåŠ¨åˆ·æ–°ï¼ˆæ··åˆç­–ç•¥ï¼‰
- âœ… è´¦å·æ± è½®è¯¢å’Œæ•…éšœåˆ‡æ¢
- âœ… OpenAI API å…¼å®¹ï¼ˆæ–‡æœ¬å¯¹è¯ï¼Œéæµå¼ï¼‰
- âœ… é…ç½®çƒ­é‡è½½
- âœ… Docker éƒ¨ç½²

**ç®¡ç†æ–¹å¼ï¼š**
- é€šè¿‡ç¼–è¾‘ `config/accounts.json` ç®¡ç†è´¦å·
- é€šè¿‡ `docker-compose logs` æŸ¥çœ‹çŠ¶æ€
- é€šè¿‡ API ç«¯ç‚¹æŸ¥çœ‹è´¦å·çŠ¶æ€

---

### Phase 2ï¼šæµå¼å“åº”å’Œå¤šæ¨¡æ€ï¼ˆ1-2å‘¨ï¼‰
**ç›®æ ‡ï¼š** å®Œå–„åŠŸèƒ½ï¼Œæ”¯æŒæµå¼è¾“å‡ºå’Œå›¾ç‰‡è¾“å…¥

**äº¤ä»˜ç‰©ï¼š**
- âœ… OpenAI æµå¼å“åº”ï¼ˆSSEï¼‰
- âœ… å›¾ç‰‡è¾“å…¥æ”¯æŒï¼ˆURL + Base64ï¼‰
- âœ… Gemini API å…¼å®¹
- âœ… Claude API å…¼å®¹

---

### Phase 3ï¼šè½»é‡çº§å‰ç«¯ï¼ˆ1å‘¨ï¼‰âœ… å·²å®Œæˆ
**ç›®æ ‡ï¼š** æä¾›å¯è§†åŒ–ç®¡ç†ç•Œé¢

**äº¤ä»˜ç‰©ï¼š**
- âœ… å•é¡µ HTML ç®¡ç†ç•Œé¢
- âœ… å®æ—¶è´¦å·çŠ¶æ€ç›‘æ§
- âœ… è´¦å·æ·»åŠ /åˆ é™¤åŠŸèƒ½
- âœ… ç®€å•æ—¥å¿—æŸ¥çœ‹

**å®Œæˆæ—¥æœŸï¼š** 2025-01-31

**å®ç°å†…å®¹ï¼š**
- Phase 3.1: ç®¡ç† API ç«¯ç‚¹ï¼ˆGET/POST/DELETE /admin/accounts, SSE æ—¥å¿—æµï¼‰
- Phase 3.2: å‰ç«¯ç•Œé¢ï¼ˆDashboardã€Accountsã€Logs ä¸‰ä¸ªé¡µé¢ï¼‰
- Phase 3.3: é™æ€æ–‡ä»¶æœåŠ¡é›†æˆ

**è®¿é—®åœ°å€ï¼š** http://localhost:8000/static/admin.html
- âœ… å®æ—¶è´¦å·çŠ¶æ€ç›‘æ§
- âœ… è´¦å·æ·»åŠ /åˆ é™¤åŠŸèƒ½
- âœ… ç®€å•æ—¥å¿—æŸ¥çœ‹

---

### Phase 4ï¼šé«˜çº§åŠŸèƒ½ï¼ˆæŒ‰éœ€ï¼‰
**ç›®æ ‡ï¼š** å®Œå–„ä½“éªŒï¼Œæ·»åŠ é«˜çº§ç‰¹æ€§

**å¯é€‰åŠŸèƒ½ï¼š**
- å›¾ç‰‡ç”Ÿæˆï¼ˆ-image æ¨¡å‹ï¼‰
- è§†é¢‘ç”Ÿæˆï¼ˆgemini-veoï¼‰
- ç»Ÿè®¡å›¾è¡¨
- æ›´è¯¦ç»†çš„æ—¥å¿—åˆ†æ

---

## ğŸ“… Phase 1 è¯¦ç»†è®¡åˆ’ï¼ˆæ ¸å¿ƒ API åŠŸèƒ½ï¼‰

### é‡Œç¨‹ç¢‘ 1.1ï¼šé¡¹ç›®éª¨æ¶æ­å»ºï¼ˆ1-2å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **åˆ›å»ºåŸºç¡€æ–‡ä»¶ç»“æ„**
  ```bash
  requirements.txt
  Dockerfile
  docker-compose.yml
  .env.example
  .gitignore
  README.md
  ```

- [ ] **åˆ›å»ºåº”ç”¨ç›®å½•ç»“æ„**
  ```bash
  app/
  â”œâ”€â”€ __init__.py
  â”œâ”€â”€ main.py
  â”œâ”€â”€ config.py
  â”œâ”€â”€ core/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ token_manager.py
  â”‚   â”œâ”€â”€ account_pool.py
  â”‚   â””â”€â”€ gemini_client.py
  â”œâ”€â”€ models/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ openai.py
  â”‚   â””â”€â”€ account.py
  â”œâ”€â”€ routes/
  â”‚   â”œâ”€â”€ __init__.py
  â”‚   â”œâ”€â”€ openai.py
  â”‚   â””â”€â”€ health.py
  â””â”€â”€ utils/
      â”œâ”€â”€ __init__.py
      â””â”€â”€ logger.py
  ```

- [ ] **é…ç½®æ–‡ä»¶æ¨¡æ¿**
  ```bash
  config/accounts.json.example
  ```

- [ ] **ä¾èµ–ç®¡ç†**
  - FastAPI
  - uvicorn
  - httpx
  - pydantic
  - python-dotenv
  - watchdog

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… é¡¹ç›®ç»“æ„å®Œæ•´
- âœ… Docker å¯ä»¥æˆåŠŸæ„å»º
- âœ… FastAPI å¯åŠ¨æˆåŠŸï¼ˆç©ºè·¯ç”±ï¼‰

---

### é‡Œç¨‹ç¢‘ 1.2ï¼šToken Manager å®ç°ï¼ˆ2-3å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å®ç° TokenManager ç±»**
  - `get_token()` - è·å–æœ‰æ•ˆ Token
  - `_refresh_token()` - åˆ·æ–° Token
  - `is_token_valid()` - æ£€æŸ¥ Token æœ‰æ•ˆæ€§
  - `should_refresh_proactively()` - åˆ¤æ–­æ˜¯å¦ä¸»åŠ¨åˆ·æ–°

- [ ] **å®ç° Token åˆ·æ–°é€»è¾‘**
  - è°ƒç”¨ `/auth/getoxsrf` è·å–ç­¾åå¯†é’¥
  - ä½¿ç”¨ HMAC-SHA256 æœ¬åœ°ç”Ÿæˆ JWT
  - JWT æœ‰æ•ˆæœŸ 300ç§’ï¼Œæå‰270ç§’åˆ·æ–°
  - å¹¶å‘ä¿æŠ¤ï¼ˆasyncio.Lockï¼‰

- [ ] **é”™è¯¯å¤„ç†**
  - 401 è®¤è¯å¤±è´¥
  - ç½‘ç»œè¶…æ—¶
  - å…¶ä»–å¼‚å¸¸

- [ ] **å•å…ƒæµ‹è¯•**
  ```python
  tests/unit/test_token_manager.py
  - test_get_token_first_time()
  - test_get_token_reuse_valid()
  - test_get_token_proactive_refresh()
  - test_refresh_failure_401()
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… å¯ä»¥ä» getoxsrf è·å–ç­¾åå¯†é’¥
- âœ… æœ¬åœ°ç”Ÿæˆçš„ JWT å¯ä»¥é€šè¿‡éªŒè¯
- âœ… Token è¿‡æœŸåè‡ªåŠ¨åˆ·æ–°ï¼ˆ270ç§’ï¼‰
- âœ… å¹¶å‘åˆ·æ–°ä¿æŠ¤ç”Ÿæ•ˆ
- âœ… å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

### é‡Œç¨‹ç¢‘ 1.3ï¼šAccount Pool å®ç°ï¼ˆ3-4å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å®ç° Account æ•°æ®æ¨¡å‹**
  ```python
  app/models/account.py
  - Account ç±»ï¼ˆemail, team_id, cookies, user_agent, created_at, expires_atï¼‰
  - çŠ¶æ€ç®¡ç†ï¼ˆactive, cooldown, expired, expiring_soon, errorï¼‰
  - å†·å´æ—¶é—´ç®¡ç†
  - è¿‡æœŸæ£€æµ‹ï¼ˆis_expired, get_remaining_days, should_warn_expiryï¼‰
  ```

- [ ] **å®ç° AccountPool ç±»**
  - `add_account()` - æ·»åŠ è´¦å·
  - `get_available_account()` - è½®è¯¢è·å–å¯ç”¨è´¦å·
  - `handle_error()` - å¤„ç†è´¦å·é”™è¯¯
  - `update_status()` - æ›´æ–°è´¦å·çŠ¶æ€

- [ ] **è½®è¯¢ç­–ç•¥**
  - Round-Robin è½®è¯¢
  - è·³è¿‡å†·å´æœŸè´¦å·
  - è·³è¿‡å·²ç¦ç”¨è´¦å·
  - å¹¶å‘å®‰å…¨ï¼ˆé”ä¿æŠ¤ï¼‰

- [ ] **å†·å´ç®¡ç†**
  - 401/403 è§¦å‘å†·å´ï¼ˆ2å°æ—¶ï¼‰
  - 429 è§¦å‘å†·å´ï¼ˆ4å°æ—¶ï¼‰
  - å†·å´æœŸåè‡ªåŠ¨æ¢å¤

- [ ] **è´¦å·ç”Ÿå‘½å‘¨æœŸç®¡ç†**
  - 30å¤©è¿‡æœŸæ£€æµ‹ï¼ˆåŸºäº created_atï¼‰
  - å‰©ä½™<3å¤©é¢„è­¦
  - è¿‡æœŸè´¦å·è‡ªåŠ¨æ ‡è®°ä¸º expired
  - å®šæœŸæ¸…ç†è¿‡æœŸè´¦å·ï¼ˆåå°ä»»åŠ¡ï¼‰

- [ ] **é…ç½®åŠ è½½**
  ```python
  app/config.py
  - load_accounts_from_json()
  - validate_account_config()
  ```

- [ ] **å•å…ƒæµ‹è¯•**
  ```python
  tests/unit/test_account_pool.py
  - test_add_account()
  - test_round_robin()
  - test_skip_cooldown()
  - test_no_available_accounts()
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… å¯ä»¥ä» JSON åŠ è½½è´¦å·
- âœ… è½®è¯¢é€»è¾‘æ­£ç¡®
- âœ… å†·å´æœºåˆ¶ç”Ÿæ•ˆ
- âœ… å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

### é‡Œç¨‹ç¢‘ 1.4ï¼šGemini Client å®ç°ï¼ˆ2-3å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å®ç° GeminiClient ç±»**
  ```python
  app/core/gemini_client.py
  - create_session()
  - send_message()
  - upload_file()
  ```

- [ ] **Session ç®¡ç†**
  - åˆ›å»º Gemini Session
  - Session ID ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
  - Session å¤ç”¨é€»è¾‘

- [ ] **API è°ƒç”¨**
  - widgetCreateSession
  - widgetStreamConverse
  - widgetAddContextFile
  - é€šç”¨è¯·æ±‚å¤´æ„å»º

- [ ] **é”™è¯¯å¤„ç†**
  - HTTP çŠ¶æ€ç å¤„ç†
  - è‡ªåŠ¨é‡è¯•é€»è¾‘
  - Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°

- [ ] **é›†æˆæµ‹è¯•**
  ```python
  tests/integration/test_gemini_client.py
  - test_create_session()
  - test_send_message()
  - test_token_auto_refresh()
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… å¯ä»¥æˆåŠŸåˆ›å»º Session
- âœ… å¯ä»¥å‘é€æ¶ˆæ¯å¹¶è·å–å“åº”
- âœ… Token è¿‡æœŸè‡ªåŠ¨åˆ·æ–°
- âœ… é›†æˆæµ‹è¯•é€šè¿‡

---

### é‡Œç¨‹ç¢‘ 1.5ï¼šOpenAI API è·¯ç”±å®ç°ï¼ˆ3-4å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **æ•°æ®æ¨¡å‹å®šä¹‰**
  ```python
  app/models/openai.py
  - OpenAIChatRequest
  - OpenAIChatMessage
  - OpenAIChatResponse
  - OpenAIChatChoice
  ```

- [ ] **æ ¼å¼è½¬æ¢å™¨**
  ```python
  app/routes/openai.py
  - OpenAIConverter ç±»
  - convert_request()
  - convert_response()
  ```

- [ ] **OpenAI è·¯ç”±å®ç°**
  ```python
  POST /v1/chat/completions
  - è§£æè¯·æ±‚
  - æ ¼å¼è½¬æ¢
  - è°ƒç”¨ Gemini API
  - è¿”å›å“åº”
  ```

- [ ] **æ¶ˆæ¯å¤„ç†**
  - System prompt è½¬æ¢
  - å¤šè½®å¯¹è¯æ”¯æŒ
  - ç®€å•æ–‡æœ¬æ¶ˆæ¯

- [ ] **é”™è¯¯å¤„ç†**
  - å‚æ•°éªŒè¯
  - è´¦å·ä¸å¯ç”¨ï¼ˆ503ï¼‰
  - API è°ƒç”¨å¤±è´¥

- [ ] **ç«¯åˆ°ç«¯æµ‹è¯•**
  ```python
  tests/e2e/test_openai_endpoint.py
  - test_simple_chat()
  - test_multi_turn_conversation()
  - test_system_prompt()
  - test_no_available_accounts()
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… OpenAI æ¥å£å¯ä»¥æ­£å¸¸è°ƒç”¨
- âœ… å“åº”æ ¼å¼ç¬¦åˆ OpenAI è§„èŒƒ
- âœ… å¤šè½®å¯¹è¯æ­£å¸¸å·¥ä½œ
- âœ… E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

### é‡Œç¨‹ç¢‘ 1.6ï¼šé…ç½®çƒ­é‡è½½å®ç°ï¼ˆ2-3å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **é…ç½®åŠ è½½å™¨**
  ```python
  app/config.py
  - ConfigLoader ç±»
  - load() - åŠ è½½é…ç½®
  - validate() - éªŒè¯é…ç½®
  - rollback() - å›æ»šé…ç½®
  ```

- [ ] **æ–‡ä»¶ç›‘å¬å™¨**
  ```python
  app/utils/config_watcher.py
  - ConfigWatcher ç±»
  - ç›‘å¬ accounts.json å˜åŒ–
  - è§¦å‘é‡è½½å›è°ƒ
  - é˜²æŠ–å¤„ç†ï¼ˆ1ç§’ï¼‰
  ```

- [ ] **AccountPool é‡è½½é€»è¾‘**
  ```python
  AccountPool.reload()
  - è¯†åˆ«æ–°å¢/åˆ é™¤/æ›´æ–°
  - ä¿ç•™ Token å’Œå†·å´çŠ¶æ€
  - Cookie å˜åŒ–æ£€æµ‹
  ```

- [ ] **å¯åŠ¨æ—¶é›†æˆ**
  ```python
  app/main.py
  - å¯åŠ¨æ—¶åŠ è½½é…ç½®
  - å¯åŠ¨æ–‡ä»¶ç›‘å¬å™¨
  - æ³¨å†Œé‡è½½å›è°ƒ
  ```

- [ ] **é›†æˆæµ‹è¯•**
  ```python
  tests/integration/test_config_reload.py
  - test_add_account()
  - test_remove_account()
  - test_update_account()
  - test_preserve_state()
  - test_invalid_json()
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… ä¿®æ”¹ JSON æ–‡ä»¶åè‡ªåŠ¨é‡è½½
- âœ… æ–°å¢è´¦å·æˆåŠŸåŠ å…¥æ± 
- âœ… åˆ é™¤è´¦å·æˆåŠŸç§»é™¤
- âœ… æ›´æ–°ä¿ç•™è¿è¡Œæ—¶çŠ¶æ€
- âœ… é”™è¯¯ JSON æ‹’ç»åŠ è½½

---

### é‡Œç¨‹ç¢‘ 1.7ï¼šDocker éƒ¨ç½²å’Œæµ‹è¯•ï¼ˆ2å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **Dockerfile ç¼–å†™**
  ```dockerfile
  FROM python:3.11-slim
  - å¤åˆ¶ä»£ç 
  - å®‰è£…ä¾èµ–
  - æš´éœ²ç«¯å£
  - å¥åº·æ£€æŸ¥
  ```

- [ ] **docker-compose.yml**
  ```yaml
  services:
    gemini-api:
      - ç«¯å£æ˜ å°„
      - Volume æŒ‚è½½
      - ç¯å¢ƒå˜é‡
      - èµ„æºé™åˆ¶
      - å¥åº·æ£€æŸ¥
  ```

- [ ] **.env.example**
  ```bash
  LOG_LEVEL=INFO
  PORT=8000
  ```

- [ ] **éƒ¨ç½²æ–‡æ¡£**
  ```markdown
  README.md
  - å¿«é€Ÿå¼€å§‹
  - ç¯å¢ƒè¦æ±‚
  - éƒ¨ç½²æ­¥éª¤
  - é…ç½®è¯´æ˜
  - å¸¸è§é—®é¢˜
  ```

- [ ] **æ ‘è“æ´¾5æµ‹è¯•**
  - åœ¨æ ‘è“æ´¾5ä¸Šéƒ¨ç½²
  - æ€§èƒ½æµ‹è¯•
  - èµ„æºå ç”¨ç›‘æ§
  - é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… Docker é•œåƒæˆåŠŸæ„å»º
- âœ… docker-compose å¯åŠ¨æˆåŠŸ
- âœ… é…ç½®çƒ­é‡è½½æ­£å¸¸å·¥ä½œ
- âœ… å¥åº·æ£€æŸ¥æ­£å¸¸
- âœ… åœ¨æ ‘è“æ´¾5ä¸Šè¿è¡Œç¨³å®š

---

### é‡Œç¨‹ç¢‘ 1.8ï¼šè´¦å·ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆ1-2å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **è´¦å·è¿‡æœŸæ£€æµ‹**
  ```python
  app/core/account.py
  - is_expired() - æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆ30å¤©ï¼‰
  - get_remaining_days() - è·å–å‰©ä½™å¤©æ•°
  - should_warn_expiry() - æ˜¯å¦åº”è­¦å‘Šï¼ˆ<3å¤©ï¼‰
  ```

- [ ] **åå°æ¸…ç†ä»»åŠ¡**
  ```python
  app/core/account_pool.py
  - cleanup_expired_accounts() - ç§»é™¤è¿‡æœŸè´¦å·
  - warn_expiring_accounts() - è­¦å‘Šå³å°†è¿‡æœŸ
  - æ¯æ—¥å®šæ—¶æ£€æŸ¥ï¼ˆasyncio åå°ä»»åŠ¡ï¼‰
  ```

- [ ] **2925é‚®ç®±é›†æˆï¼ˆå¯é€‰ï¼‰**
  ```python
  app/utils/mail_2925.py
  - Mail2925Handler - IMAP é‚®ç®±å¤„ç†å™¨
  - get_verification_code() - è·å–éªŒè¯ç 
  - é…åˆ Playwright è‡ªåŠ¨æ³¨å†Œ
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… è¿‡æœŸè´¦å·è‡ªåŠ¨æ£€æµ‹å’Œæ ‡è®°
- âœ… æ—¥å¿—è­¦å‘Šå³å°†è¿‡æœŸï¼ˆ<3å¤©ï¼‰
- âœ… åå°ä»»åŠ¡æ­£å¸¸è¿è¡Œ
- âœ… è¿‡æœŸè´¦å·ä¸ä¼šè¢«é€‰ä¸­ä½¿ç”¨

---

### é‡Œç¨‹ç¢‘ 1.9ï¼šå¥åº·æ£€æŸ¥å’Œç›‘æ§ APIï¼ˆ1-2å¤©ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**

- [ ] **å¥åº·æ£€æŸ¥ç«¯ç‚¹**
  ```python
  GET /health
  {
    "status": "healthy",
    "timestamp": "2025-01-31T10:00:00",
    "accounts": {
      "total": 5,
      "active": 2,
      "cooldown": 1,
      "expired": 1,
      "expiring_soon": 1
    }
  }
  ```

- [ ] **è´¦å·çŠ¶æ€ API**
  ```python
  GET /admin/accounts
  {
    "accounts": [
      {
        "email": "gemini1@goodcv.fun",
        "team_id": "xxx",
        "status": "active",
        "token_expires_in": 270,
        "cooldown_remaining": 0,
        "account_age_days": 15,
        "remaining_days": 15,
        "request_count": 123
      }
    ]
  }
  ```

- [ ] **æ—¥å¿—é…ç½®**
  ```python
  app/utils/logger.py
  - ç»“æ„åŒ–æ—¥å¿—
  - æ—¥å¿—çº§åˆ«é…ç½®
  - æ—¥å¿—æ ¼å¼åŒ–
  ```

**éªŒæ”¶æ ‡å‡†ï¼š**
- âœ… å¥åº·æ£€æŸ¥è¿”å›æ­£ç¡®çŠ¶æ€
- âœ… è´¦å·çŠ¶æ€ API æ­£å¸¸å·¥ä½œ
- âœ… æ—¥å¿—è¾“å‡ºæ¸…æ™°å¯è¯»

---

## ğŸ“Š Phase 1 å·¥ä½œé‡ä¼°ç®—

| é‡Œç¨‹ç¢‘ | é¢„è®¡å·¥æ—¶ | å¤æ‚åº¦ |
|--------|---------|--------|
| 1.1 é¡¹ç›®éª¨æ¶ | 1-2å¤© | ä½ |
| 1.2 Token Manager | 2-3å¤© | ä¸­ |
| 1.3 Account Pool | 3-4å¤© | é«˜ |
| 1.4 Gemini Client | 2-3å¤© | ä¸­ |
| 1.5 OpenAI API è·¯ç”± | 3-4å¤© | é«˜ |
| 1.6 é…ç½®çƒ­é‡è½½ | 2-3å¤© | ä¸­ |
| 1.7 Docker éƒ¨ç½² | 2å¤© | ä½ |
| 1.8 è´¦å·ç”Ÿå‘½å‘¨æœŸ | 1-2å¤© | ä¸­ |
| 1.9 ç›‘æ§ API | 1-2å¤© | ä½ |
| **æ€»è®¡** | **17-25å¤©** | - |

**å»ºè®®æ—¶é—´ï¼š** 3-4å‘¨ï¼ˆè€ƒè™‘æµ‹è¯•å’Œè°ƒè¯•ï¼‰

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥ï¼ˆPhase 1ï¼‰

### å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… Token Managerï¼ˆ95%+ï¼‰
- âœ… Account Poolï¼ˆ90%+ï¼‰
- âœ… Config Loaderï¼ˆ85%+ï¼‰
- âœ… OpenAI Converterï¼ˆ85%+ï¼‰

### é›†æˆæµ‹è¯•
- âœ… Token Manager + Gemini API
- âœ… Account Pool + Config Reload
- âœ… Gemini Client + Token Refresh

### ç«¯åˆ°ç«¯æµ‹è¯•
- âœ… OpenAI æ¥å£å®Œæ•´æµç¨‹
- âœ… å¤šè´¦å·è½®è¯¢
- âœ… æ•…éšœåˆ‡æ¢
- âœ… é…ç½®çƒ­é‡è½½

### æ€§èƒ½æµ‹è¯•
- âœ… å¹¶å‘100è¯·æ±‚
- âœ… å†…å­˜å ç”¨ < 512MB
- âœ… P95 å“åº”æ—¶é—´ < 5ç§’

---

## ğŸ“… Phase 2 è®¡åˆ’æ¦‚è§ˆï¼ˆæµå¼å’Œå¤šæ¨¡æ€ï¼‰

**é¢„è®¡æ—¶é—´ï¼š** 1-2å‘¨

**æ ¸å¿ƒä»»åŠ¡ï¼š**
1. OpenAI æµå¼å“åº”ï¼ˆSSEï¼‰
2. å›¾ç‰‡è¾“å…¥æ”¯æŒ
3. Gemini API å…¼å®¹
4. Claude API å…¼å®¹

**è¯¦ç»†è®¡åˆ’ï¼š** åœ¨ Phase 1 å®Œæˆååˆ¶å®š

---

## ğŸ“… Phase 3 è®¡åˆ’æ¦‚è§ˆï¼ˆè½»é‡çº§å‰ç«¯ï¼‰

**é¢„è®¡æ—¶é—´ï¼š** 1å‘¨

**æ ¸å¿ƒä»»åŠ¡ï¼š**
1. å•é¡µ HTML ç•Œé¢
2. è´¦å·çŠ¶æ€ç›‘æ§
3. è´¦å·æ·»åŠ /åˆ é™¤è¡¨å•
4. ç®€å•æ—¥å¿—æŸ¥çœ‹

**æŠ€æœ¯æ ˆï¼š**
- Vue 3 CDN
- Tailwind CSS CDN
- Chart.jsï¼ˆå¯é€‰ï¼Œç”¨äºçŠ¶æ€å›¾è¡¨ï¼‰

**è¯¦ç»†è®¡åˆ’ï¼š** åœ¨ Phase 2 å®Œæˆååˆ¶å®š

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### Phase 1 å®Œæˆæ ‡å‡†
- âœ… OpenAI API `/v1/chat/completions` æ­£å¸¸å·¥ä½œ
- âœ… å¤šè´¦å·è½®è¯¢å’Œæ•…éšœåˆ‡æ¢æ­£å¸¸
- âœ… Token è‡ªåŠ¨åˆ·æ–°æ­£å¸¸
- âœ… é…ç½®çƒ­é‡è½½æ­£å¸¸
- âœ… Docker éƒ¨ç½²æˆåŠŸ
- âœ… åœ¨æ ‘è“æ´¾5ä¸Šç¨³å®šè¿è¡Œ
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… æ‰€æœ‰ E2E æµ‹è¯•é€šè¿‡

### éªŒæ”¶æµ‹è¯•
```bash
# 1. éƒ¨ç½²æµ‹è¯•
docker-compose up -d
curl http://localhost:8000/health

# 2. åŠŸèƒ½æµ‹è¯•
curl -X POST http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash",
    "messages": [{"role": "user", "content": "Hello"}]
  }'

# 3. çƒ­é‡è½½æµ‹è¯•
echo 'æ–°å¢è´¦å·åˆ° config/accounts.json'
docker-compose logs | grep CONFIG

# 4. æ•…éšœåˆ‡æ¢æµ‹è¯•
# æ¨¡æ‹Ÿè´¦å·å¤±è´¥ï¼ŒéªŒè¯è‡ªåŠ¨åˆ‡æ¢

# 5. æ€§èƒ½æµ‹è¯•
# å¹¶å‘100è¯·æ±‚ï¼ŒéªŒè¯ç¨³å®šæ€§
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ
- Pythonï¼šPEP 8
- ç±»å‹æç¤ºï¼šä½¿ç”¨ Type Hints
- æ–‡æ¡£å­—ç¬¦ä¸²ï¼šGoogle Style

### Git å·¥ä½œæµ
```bash
main        # ç¨³å®šç‰ˆæœ¬
develop     # å¼€å‘åˆ†æ”¯
feature/*   # åŠŸèƒ½åˆ†æ”¯
```

### æäº¤è§„èŒƒ
```
feat: æ·»åŠ  Token Manager
fix: ä¿®å¤è´¦å·è½®è¯¢ bug
docs: æ›´æ–° README
test: æ·»åŠ  Account Pool å•å…ƒæµ‹è¯•
refactor: é‡æ„é…ç½®åŠ è½½é€»è¾‘
```

### åˆ†æ”¯ç­–ç•¥
```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/token-manager

# å¼€å‘å®Œæˆååˆå¹¶åˆ° develop
git checkout develop
git merge feature/token-manager

# æµ‹è¯•é€šè¿‡ååˆå¹¶åˆ° main
git checkout main
git merge develop
git tag v1.0.0
```

---

## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®

### æœ¬åœ°å¼€å‘
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-test.txt

# è¿è¡Œæµ‹è¯•
pytest

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --port 8000
```

### Docker å¼€å‘
```bash
# æ„å»ºé•œåƒ
docker build -t gemini-api:dev .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 -v $(pwd)/config:/app/config gemini-api:dev

# æŸ¥çœ‹æ—¥å¿—
docker logs -f <container-id>
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å·²å®Œæˆçš„è®¾è®¡æ–‡æ¡£
1. âœ… 01-architecture-design.mdï¼ˆå·²æ›´æ–°ï¼šJWTæœ¬åœ°ç”Ÿæˆï¼Œ30å¤©ç”Ÿå‘½å‘¨æœŸï¼‰
2. âœ… 02-api-compatibility-layer.md
3. âœ… 03-config-hot-reload.md
4. âœ… 04-deployment-and-operations.md
5. âœ… 05-testing-strategy.md
6. âœ… 06-implementation-plan.mdï¼ˆæœ¬æ–‡æ¡£ï¼‰
7. âœ… 07-account-lifecycle-management.mdï¼ˆå³å°†åˆ›å»ºï¼‰

### å‚è€ƒé¡¹ç›®
- gemini-business2api
- business-gemini-pool
- gemini-business (linlee996)

### API æ–‡æ¡£
- Gemini Business APIï¼ˆéœ€é€†å‘ï¼‰
- OpenAI API å®˜æ–¹æ–‡æ¡£
- Claude API å®˜æ–¹æ–‡æ¡£

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆæ¨èé¡ºåºï¼‰

**é€‰é¡¹ Aï¼šä»å¤´å¼€å§‹ç¼–ç **
1. åˆ›å»ºé¡¹ç›®éª¨æ¶ï¼ˆé‡Œç¨‹ç¢‘ 1.1ï¼‰
2. å®ç° Token Managerï¼ˆé‡Œç¨‹ç¢‘ 1.2ï¼‰
3. é€æ­¥æ¨è¿›å…¶ä»–é‡Œç¨‹ç¢‘

**é€‰é¡¹ Bï¼šåˆ›å»ºéª¨æ¶åæš‚åœ**
1. åˆ›å»ºå®Œæ•´çš„é¡¹ç›®éª¨æ¶
2. é…ç½®å¥½å¼€å‘ç¯å¢ƒ
3. ä½ è‡ªè¡Œå¼€å‘æˆ–ç­‰å¾…è¿›ä¸€æ­¥æŒ‡ç¤º

**é€‰é¡¹ Cï¼šè°ƒæ•´è®¡åˆ’**
- ä½ å…ˆå®¡é˜…æ­¤è®¡åˆ’
- æå‡ºä¿®æ”¹æ„è§
- è°ƒæ•´ä¼˜å…ˆçº§æˆ–æ—¶é—´ä¼°ç®—

---

## âœ… Phase 1 æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹ç¼–ç å‰ï¼š
- [ ] å·²é˜…è¯»æ‰€æœ‰7ä»½è®¾è®¡æ–‡æ¡£
- [ ] ç†è§£ Token åˆ·æ–°ç­–ç•¥ï¼ˆæœ¬åœ°ç”ŸæˆJWTï¼Œ5åˆ†é’Ÿï¼‰
- [ ] ç†è§£è´¦å·æ± è½®è¯¢é€»è¾‘
- [ ] ç†è§£é…ç½®çƒ­é‡è½½æœºåˆ¶
- [ ] ç†è§£30å¤©è´¦å·ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [ ] å‡†å¤‡å¥½æµ‹è¯•è´¦å·ï¼ˆæˆ–å‡†å¤‡2925é‚®ç®±è‡ªåŠ¨æ³¨å†Œï¼‰
- [ ] æ ‘è“æ´¾5ç¯å¢ƒå·²å°±ç»ª

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼š
- [ ] æ¯ä¸ªé‡Œç¨‹ç¢‘å®Œæˆåç¼–å†™æµ‹è¯•
- [ ] æ¯ä¸ªåŠŸèƒ½å®Œæˆåæ‰‹åŠ¨æµ‹è¯•
- [ ] åŠæ—¶æ›´æ–°æ–‡æ¡£
- [ ] å®šæœŸæäº¤ä»£ç 

åœ¨ Phase 1 å®Œæˆæ—¶ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰ E2E æµ‹è¯•é€šè¿‡
- [ ] Docker éƒ¨ç½²æˆåŠŸ
- [ ] åœ¨æ ‘è“æ´¾5ä¸Šæµ‹è¯•é€šè¿‡
- [ ] ç¼–å†™ Phase 2 è¯¦ç»†è®¡åˆ’

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²ï¼š**
- v1.1 (2025-01-31): æ›´æ–°Tokenåˆ·æ–°æœºåˆ¶ï¼ˆæœ¬åœ°ç”ŸæˆJWTï¼‰ï¼Œæ–°å¢è´¦å·ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆé‡Œç¨‹ç¢‘1.8ï¼‰
- v1.0 (2025-01-31): åˆå§‹ç‰ˆæœ¬ï¼ŒPhase 1 è¯¦ç»†è®¡åˆ’
